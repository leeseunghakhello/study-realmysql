# 2장

## MySQL macOS Homebrew 명령어 정리

맥 OS는 rpm패키지로 설치할 필요x

맥 OS는 yum / apt-get 지원x → Homebrew 사용(macOS 운영체제용으로 개발된 패키지 관리 도구)

맥 OS는 리눅스와는 다른 운영체제 →

MySQL실행 명령어

- `brew services start mysql`

MySQL종료 명령어

- `brew services stop mysql`
  MySQL경로 확인 명령어
- `which mysql`

MySQL의 상태를 확인 명령어

- `brew services list`

MySQL접속 명령어

- `mysql -u root -p`

MySQL접속 후 나가는 명령어

- `\q`


# MysqlL과 Mysqld 차이점

1. **mysqld (MySQL Server Daemon)**:
    - **`mysqld`**는 MySQL 데이터베이스 서버 자체를 나타냅니다.
    - "Daemon"이라는 용어는 백그라운드에서 실행되는 프로세스를 의미합니다.
    - **`mysqld`**는 클라이언트의 연결을 수락하고, SQL 쿼리를 처리하고, 데이터베이스에 저장된 데이터에 액세스할 수 있게 해줍니다.
    - 다시 말해, **`mysqld`**는 실제로 데이터베이스의 모든 주요 작업을 처리하는 핵심 컴포넌트입니다.
2. **mysql (MySQL Client)**:
    - **`mysql`**은 MySQL 서버에 연결하는데 사용되는 텍스트 기반의 클라이언트 프로그램입니다.
    - 사용자는 이 클라이언트를 사용하여 SQL 쿼리를 작성하고 실행하거나 데이터베이스 관리 작업을 수행할 수 있습니다.
    - 즉, **`mysql`**은 사용자와 **`mysqld`** 서버 사이의 인터페이스 역할을 합니다.

요약하면, **`mysqld`**는 실제 데이터베이스 서버를 나타내며, **`mysql`**은 그 서버에 연결하여 작업을 수행하기 위한 클라이언트 도구입니다.


## 시스템 변수

MySQL 시스템 변수는 MySQL 서버의 작동 방식과 성능을 제어하는데 사용됩니다. 이 변수들은 서버의 시작 시 **`my.cnf`** (또는 **`my.ini`**라는 이름의 파일에서 Windows 환경에서)와 같은 설정 파일에서 초기값을 로드할 수 있으며, 실행 중인 서버의 동작을 변경하기 위해 동적으로 조절될 수도 있습니다.

시스템 변수의 주요 특징 및 분류는 다음과 같습니다:

1. **글로벌 vs 세션 변수**:
    - **글로벌 변수**: 모든 연결에 대한 기본 설정을 나타냅니다. 예를 들어, **`global.max_connections`**은 동시에 허용되는 최대 연결 수를 지정합니다.
    - **세션 변수**: 특정 클라이언트 연결에만 적용되는 변수입니다. 세션 변수는 해당 연결 동안만 유효하며 연결이 종료되면 사라집니다.
2. **정적 vs 동적 변수**:
    - **정적 변수**: MySQL 서버가 시작될 때만 설정할 수 있는 변수입니다. 실행 중인 서버에서는 변경할 수 없습니다.
    - **동적 변수**: 실행 중인 MySQL 서버에서도 값을 변경할 수 있는 변수입니다.
3. **설정 예시**:
    - **`innodb_buffer_pool_size`**: InnoDB 스토리지 엔진의 버퍼 풀 크기를 지정합니다.
    - **`max_connections`**: 서버가 동시에 수용할 수 있는 최대 연결 수를 지정합니다.
    - **`query_cache_size`**: 쿼리 캐시의 크기를 지정합니다.

시스템 변수를 확인하거나 설정하려면, MySQL 쉘에서 다음과 같은 명령을 사용할 수 있습니다:

- 특정 변수의 값을 확인하기: **`SHOW VARIABLES LIKE 'variable_name';`**
- 글로벌 변수 설정하기: **`SET GLOBAL variable_name = value;`**
- 세션 변수 설정하기: **`SET SESSION variable_name = value;`**

MySQL의 시스템 변수는 많이 있으므로, 원하는 성능 및 작동 방식을 얻기 위해 적절한 값으로 설정하는 것이 중요합니다. MySQL 공식 문서에서 각 변수의 설명 및 권장 값에 대한 자세한 정보를 찾을 수 있습니다.


## 글로벌 변수와 세션 변수의 차이점

1. **글로벌 변수 (Global Variables)**:
    - 이 변수들은 MySQL 서버 전체에 영향을 미칩니다.
    - 모든 클라이언트 및 연결에 대해 동일한 값을 가집니다.
    - 서버를 재시작하면 기본값으로 재설정되거나 **`my.cnf`** 또는 **`my.ini`**와 같은 설정 파일에서 정의된 값으로 설정됩니다.
    - **`SET GLOBAL`** 구문을 사용하여 글로벌 변수를 설정할 수 있습니다. 그러나 이 작업은 적절한 권한이 있는 사용자만 수행할 수 있습니다.
    - 예: **`SET GLOBAL max_connections = 1000;`**
2. **세션 변수 (Session Variables)**:
    - 이 변수들은 현재 클라이언트 연결 또는 세션에만 영향을 미칩니다.
    - 각 클라이언트 연결 또는 세션은 자신의 세션 변수 값을 가질 수 있으며, 다른 세션의 값을 변경하지 않습니다.
    - 세션 종료 시 변수 값은 사라지며, 새로운 세션은 해당 변수의 글로벌 값을 사용하여 초기화됩니다.
    - **`SET SESSION`** 구문을 사용하여 세션 변수를 설정할 수 있습니다. 그러나 일반적으로 **`SESSION`** 키워드는 생략할 수 있습니다.
    - 예: **`SET SESSION sql_mode = 'STRICT_ALL_TABLES';`** 또는 **`SET sql_mode = 'STRICT_ALL_TABLES';`**

MySQL에서 글로벌 및 세션 변수의 현재 값을 확인하려면 **`SHOW VARIABLES`** 명령을 사용하며, 특정 범주의 변수만 조회하려면 **`SHOW GLOBAL VARIABLES`** 또는 **`SHOW SESSION VARIABLES`**를 사용할 수 있습니다.


## 정적 변수와 동적 변수

1. **정적 변수 (Static Variables)**:
    - 이 변수들은 서버 시작 시에만 설정할 수 있습니다.
    - 서버가 실행 중일 때 이러한 변수의 값을 변경하려고 하면 에러가 발생합니다.
    - 값을 변경하려면 **`my.cnf`** 또는 **`my.ini`** 같은 MySQL 설정 파일을 수정한 후 서버를 재시작해야 합니다.
    - 예: **`innodb_data_file_path`**는 InnoDB 스토리지 엔진에 대한 설정이며, 이 변수는 정적입니다.
2. **동적 변수 (Dynamic Variables)**:
    - 이 변수들은 MySQL 서버가 실행 중일 때도 변경할 수 있습니다.
    - **`SET GLOBAL`** 또는 **`SET SESSION`** 명령을 사용하여 이러한 변수의 값을 변경할 수 있습니다.
    - 동적 변수의 변경은 서버 재시작 없이 즉시 적용됩니다.
    - 예: **`max_connections`**는 동시에 허용되는 최대 클라이언트 연결 수를 지정하는 동적 변수입니다.

서버 변수가 정적인지 동적인지 확인하려면 MySQL의 공식 문서나 **`SHOW VARIABLES`** 명령을 사용하여 변수의 정보를 확인하면 됩니다.

MySQL 서버의 시스템 변수는 MySQL 서버가 기동 중인 상태에서 변경 가능한지에 따라 동적 변수와 정적 변수로 구분된다. MySQL 서버의 시스템 변수는 디스크에 저장돼 있는 설정 파일(my.cnf 또는 my.ini)을 변경하는 경우와, 이미 기동 중인 MySQL서버의 메모리에 있는 MySQL 서버의 시스템 변수를 변경하는 경우로 구분할 수 있다. 디스크에 저장된 설정 파일의 내용은 변경하더라도 MySQL 서버가 재시작하기 전에는 적용되지 않는다. 만약 변수명을 정확히 모른다면 SQL 문장의 LIKE처럼 SHOW 명령에서 %문자를 이용해 패턴 검색을 하는 것도 가능하다.

`mysq1) SHOW GLOBAL VARIABLES LIKE "%max connections%';`

`mysql) SET GLOBAL max_connections=500;`

`mysq1) SHOW GLOBAL VARIABLES LKIE 'max_connections’`


## SET PERSIST 명령과 SET PERSIST_ONLY 명령어의 차이점

MySQL 8.0부터는 시스템 변수의 값을 설정하면서 해당 값을 영구적으로 유지하려는 경우 **`SET PERSIST`** 및 **`SET PERSIST_ONLY`** 옵션을 사용할 수 있습니다. 이 두 명령어의 차이점은 다음과 같습니다:

1. **SET PERSIST**:
    - **`SET PERSIST`**를 사용하여 변수 값을 설정하면, 해당 값은 현재 MySQL 세션뿐만 아니라 MySQL 서버 전체에 즉시 적용됩니다.
    - 추가로, 설정한 값은 **`mysqld-auto.cnf`** 파일에 저장되므로, 서버가 재시작된 경우에도 해당 값이 유지됩니다.
    - 예: **`SET PERSIST max_connections = 1500;`**
2. **SET PERSIST_ONLY**:
    - **`SET PERSIST_ONLY`**를 사용하여 변수 값을 설정하면, 해당 값은 현재 실행 중인 MySQL 서버에는 적용되지 않습니다.
    - 대신, 설정한 값만 **`mysqld-auto.cnf`** 파일에 저장됩니다. 따라서 서버가 다음에 재시작될 때 해당 값이 적용됩니다.
    - 이 명령은 변수 값을 "미래에 적용하려는" 경우에 유용하며, 현재 실행 중인 서버의 동작에는 영향을 주지 않습니다.
    - 예: **`SET PERSIST_ONLY max_connections = 1500;`**
3. **RESET PERSIST:**
- SET PERSIST나 SET PERSIST_ONLY 명령으로 추가된 시스템 변수의 내용을 삭제해야 할 때도 있다.
- 이때 mysqld-auto.cnf 파일의 내용을 직접 변경하다가 내용상 오류를 만드는 경우 MySQL 서버가 시작되지 못할 수 있다. 그래서 mysqld-auto.cnf 의 파일의 내용을 삭제해야 하는 경우에는 `RESET PERSIST`

이 기능은 설정 변경을 여러 번 테스트하거나 조정할 필요가 있는 경우, 서버 재시작 없이도 영구적인 변경을 저장할 수 있도록 도와줍니다.

하지만 SET명령을 통해 변경되는 시스템 변수값이 MySQL의 설정 파일인 my.cnf파일에 반영되는 것은 아니기 때문에 현재 기동 중인 MySQL의 인스턴스에서만 유효하다. 그러나 MySQL 8.0 버전부터는 SET PERSIST명령을 이용하면 실행중인 MySQL서버의 시스템 변수를 변경함과 동시에 자동으로 설정 파일로도 기록된다.

`mysql> SET PERSIST max_connections=5000;`

이렇게 SET PERSIST명령으로 시스템 변수를 변경하면 MySQL 서버는 변경된 값을 즉시 적용함과 동시에 별도의 설정 파일(mysqld-auto.cnf)에 변경 내용을 추가로 기록해 둔다.

MySQL에는 다양한 설정 파일들이 있을 수 있으며, 주요 설정 파일은 **`my.cnf`** 또는 **`my.ini`**입니다. 그러나 여러가지 이유로 추가 설정 파일들이 존재할 수 있습니다. **`mysqld-auto.cnf`**와 **`my.cnf`** 사이의 기본적인 차이점은 다음과 같습니다:

1. **my.cnf**:(사용자가 **직접** 편집하는 설정 파일)
    - 이 파일은 MySQL 서버의 주 설정 파일입니다.
    - 여기에는 서버의 동작 방식, 인증, 네트워킹, 로깅, 퍼포먼스 튜닝 등과 관련된 다양한 설정이 포함될 수 있습니다.
    - 일반적으로 시스템 전체에 적용되는 설정 또는 MySQL 서버의 주요 동작에 관한 설정이 이 파일에 포함됩니다.
    - MySQL 서버가 시작될 때 이 파일을 읽어 들입니다.
2. **mysqld-auto.cnf**:(MySQL이 **자동으로** 관리하는 설정 파일)
    - 이 파일은 MySQL 서버가 자동으로 생성하고 관리하는 설정 파일입니다.
    - **`AUTO_INCREMENT`** 카운터 값 등의 일부 시스템 설정을 저장하는 데 사용될 수 있습니다.
    - 일반적으로 사용자가 직접 이 파일을 편집하거나 변경하는 것은 추천되지 않습니다.

MySQL 서버는 시작할 때 여러 설정 파일의 위치를 확인하여 설정 값을 로드합니다. 이러한 설정 파일들은 서로 다른 디렉토리에 있을 수 있으므로, 필요한 설정을 정확하게 찾기 위해 해당 위치를 확인하는 것이 중요합니다.

마지막으로, 항상 설정 파일을 편집하기 전에 백업을 가져야 합니다. 잘못된 설정은 MySQL 서버의 동작에 문제를 일으킬 수 있으므로 주의가 필요합니다.
